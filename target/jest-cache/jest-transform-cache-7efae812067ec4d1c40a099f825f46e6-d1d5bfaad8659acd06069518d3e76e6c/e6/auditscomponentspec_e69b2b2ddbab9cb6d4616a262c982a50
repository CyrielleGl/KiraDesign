fbdd09bdc6ee39ecfa670829bd6360a4
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@angular/core/testing");
const http_1 = require("@angular/common/http");
const router_1 = require("@angular/router");
const rxjs_1 = require("rxjs");
const jest_date_mock_1 = require("jest-date-mock");
const test_module_1 = require("../../../test.module");
const audits_component_1 = require("app/admin/audits/audits.component");
const audits_service_1 = require("app/admin/audits/audits.service");
const audit_model_1 = require("app/admin/audits/audit.model");
const pagination_constants_1 = require("app/shared/constants/pagination.constants");
function build2DigitsDatePart(datePart) {
    return `0${datePart}`.slice(-2);
}
function getDate(isToday = true) {
    let date = new Date();
    if (isToday) {
        // Today + 1 day - needed if the current day must be included
        date.setDate(date.getDate() + 1);
    }
    else {
        // get last month
        if (date.getMonth() === 0) {
            date = new Date(date.getFullYear() - 1, 11, date.getDate());
        }
        else {
            date = new Date(date.getFullYear(), date.getMonth() - 1, date.getDate());
        }
    }
    const monthString = build2DigitsDatePart(date.getMonth() + 1);
    const dateString = build2DigitsDatePart(date.getDate());
    return `${date.getFullYear()}-${monthString}-${dateString}`;
}
describe('Component Tests', () => {
    describe('AuditsComponent', () => {
        let comp;
        let fixture;
        let service;
        let mockRouter;
        let mockActivatedRoute;
        beforeEach(testing_1.async(() => {
            testing_1.TestBed.configureTestingModule({
                imports: [test_module_1.KiraTestModule],
                declarations: [audits_component_1.AuditsComponent],
                providers: [audits_service_1.AuditsService],
            })
                .overrideTemplate(audits_component_1.AuditsComponent, '')
                .compileComponents();
        }));
        beforeEach(() => {
            fixture = testing_1.TestBed.createComponent(audits_component_1.AuditsComponent);
            comp = fixture.componentInstance;
            service = fixture.debugElement.injector.get(audits_service_1.AuditsService);
            mockRouter = testing_1.TestBed.get(router_1.Router);
            mockActivatedRoute = testing_1.TestBed.get(router_1.ActivatedRoute);
        });
        describe('today function', () => {
            it('should set toDate to current date', () => {
                comp.ngOnInit();
                expect(comp.toDate).toBe(getDate());
            });
            it('if current day is last day of month then should set toDate to first day of next month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 0, 31, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.toDate).toBe('2019-02-01');
            });
            it('if current day is not last day of month then should set toDate to next day of current month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 0, 27, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.toDate).toBe('2019-01-28');
            });
        });
        describe('previousMonth function', () => {
            it('should set fromDate to previous month', () => {
                comp.ngOnInit();
                expect(comp.fromDate).toBe(getDate(false));
            });
            it('if current month is January then should set fromDate to previous year last month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 0, 20, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.fromDate).toBe('2018-12-20');
            });
            it('if current month is not January then should set fromDate to current year previous month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 1, 20, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.fromDate).toBe('2019-01-20');
            });
        });
        describe('By default, on init', () => {
            it('should set all default values correctly', () => {
                fixture.detectChanges();
                expect(comp.toDate).toBe(getDate());
                expect(comp.fromDate).toBe(getDate(false));
                expect(comp.itemsPerPage).toBe(pagination_constants_1.ITEMS_PER_PAGE);
                expect(comp.page).toBe(1);
                expect(comp.ascending).toBe(false);
                expect(comp.predicate).toBe('id');
            });
        });
        describe('OnInit', () => {
            it('Should call load all on init', () => {
                // GIVEN
                const headers = new http_1.HttpHeaders().append('X-Total-Count', '1');
                const audit = new audit_model_1.Audit({ remoteAddress: '127.0.0.1', sessionId: '123' }, 'user', '20140101', 'AUTHENTICATION_SUCCESS');
                spyOn(service, 'query').and.returnValue(rxjs_1.of(new http_1.HttpResponse({
                    body: [audit],
                    headers,
                })));
                // WHEN
                comp.ngOnInit();
                // THEN
                expect(service.query).toHaveBeenCalledTimes(1);
                expect(comp.audits && comp.audits[0]).toEqual(jasmine.objectContaining(audit));
                expect(comp.totalItems).toBe(1);
            });
        });
        describe('Create sort object', () => {
            beforeEach(() => {
                spyOn(service, 'query').and.returnValue(rxjs_1.of(new http_1.HttpResponse({ body: null })));
            });
            it('Should sort only by id asc', () => {
                // GIVEN
                mockActivatedRoute.setParameters({
                    sort: 'id,desc',
                });
                // WHEN
                comp.ngOnInit();
                // THEN
                expect(service.query).toBeCalledWith(expect.objectContaining({
                    sort: ['id,desc'],
                }));
            });
            it('Should sort by timestamp asc then by id', () => {
                // GIVEN
                mockActivatedRoute.setParameters({
                    sort: 'timestamp,asc',
                });
                // WHEN
                comp.ngOnInit();
                // THEN
                expect(service.query).toBeCalledWith(expect.objectContaining({
                    sort: ['timestamp,asc', 'id'],
                }));
            });
        });
        describe('transition', () => {
            it('Should not query data if fromDate and toDate are empty', () => {
                // GIVEN
                comp.toDate = '';
                comp.fromDate = '';
                // WHEN
                comp.transition();
                // THEN
                expect(comp.canLoad()).toBe(false);
                expect(mockRouter.navigateSpy).not.toBeCalled();
            });
            it('Should query data if fromDate and toDate are not empty', () => {
                // GIVEN
                comp.toDate = getDate();
                comp.fromDate = getDate(false);
                // WHEN
                comp.transition();
                // THEN
                expect(comp.canLoad()).toBe(true);
                expect(mockRouter.navigateSpy).toBeCalled();
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXDEuUFJPR1JBTU1BVElPTlxcSkhJUFNURVJcXGtpcmFcXHNyY1xcdGVzdFxcamF2YXNjcmlwdFxcc3BlY1xcYXBwXFxhZG1pblxcYXVkaXRzXFxhdWRpdHMuY29tcG9uZW50LnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxtREFBeUU7QUFDekUsK0NBQWlFO0FBQ2pFLDRDQUF5RDtBQUN6RCwrQkFBMEI7QUFDMUIsbURBQTJDO0FBRTNDLHNEQUFzRDtBQUN0RCx3RUFBb0U7QUFDcEUsb0VBQWdFO0FBQ2hFLDhEQUFxRDtBQUNyRCxvRkFBMkU7QUFHM0UsU0FBUyxvQkFBb0IsQ0FBQyxRQUFnQjtJQUM1QyxPQUFPLElBQUksUUFBUSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEMsQ0FBQztBQUVELFNBQVMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJO0lBQzdCLElBQUksSUFBSSxHQUFTLElBQUksSUFBSSxFQUFFLENBQUM7SUFDNUIsSUFBSSxPQUFPLEVBQUU7UUFDWCw2REFBNkQ7UUFDN0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDbEM7U0FBTTtRQUNMLGlCQUFpQjtRQUNqQixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFDekIsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1NBQzdEO2FBQU07WUFDTCxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7U0FDMUU7S0FDRjtJQUNELE1BQU0sV0FBVyxHQUFHLG9CQUFvQixDQUFDLElBQUksQ0FBQyxR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Q0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFwxLlBST0dSQU1NQVRJT05cXEpISVBTVEVSXFxraXJhXFxzcmNcXHRlc3RcXGphdmFzY3JpcHRcXHNwZWNcXGFwcFxcYWRtaW5cXGF1ZGl0c1xcYXVkaXRzLmNvbXBvbmVudC5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudEZpeHR1cmUsIFRlc3RCZWQsIGFzeW5jIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS90ZXN0aW5nJztcbmltcG9ydCB7IEh0dHBIZWFkZXJzLCBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBSb3V0ZXIsIEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBhZHZhbmNlVG8gfSBmcm9tICdqZXN0LWRhdGUtbW9jayc7XG5cbmltcG9ydCB7IEtpcmFUZXN0TW9kdWxlIH0gZnJvbSAnLi4vLi4vLi4vdGVzdC5tb2R1bGUnO1xuaW1wb3J0IHsgQXVkaXRzQ29tcG9uZW50IH0gZnJvbSAnYXBwL2FkbWluL2F1ZGl0cy9hdWRpdHMuY29tcG9uZW50JztcbmltcG9ydCB7IEF1ZGl0c1NlcnZpY2UgfSBmcm9tICdhcHAvYWRtaW4vYXVkaXRzL2F1ZGl0cy5zZXJ2aWNlJztcbmltcG9ydCB7IEF1ZGl0IH0gZnJvbSAnYXBwL2FkbWluL2F1ZGl0cy9hdWRpdC5tb2RlbCc7XG5pbXBvcnQgeyBJVEVNU19QRVJfUEFHRSB9IGZyb20gJ2FwcC9zaGFyZWQvY29uc3RhbnRzL3BhZ2luYXRpb24uY29uc3RhbnRzJztcbmltcG9ydCB7IE1vY2tSb3V0ZXIsIE1vY2tBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJy4uLy4uLy4uL2hlbHBlcnMvbW9jay1yb3V0ZS5zZXJ2aWNlJztcblxuZnVuY3Rpb24gYnVpbGQyRGlnaXRzRGF0ZVBhcnQoZGF0ZVBhcnQ6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBgMCR7ZGF0ZVBhcnR9YC5zbGljZSgtMik7XG59XG5cbmZ1bmN0aW9uIGdldERhdGUoaXNUb2RheSA9IHRydWUpOiBzdHJpbmcge1xuICBsZXQgZGF0ZTogRGF0ZSA9IG5ldyBEYXRlKCk7XG4gIGlmIChpc1RvZGF5KSB7XG4gICAgLy8gVG9kYXkgKyAxIGRheSAtIG5lZWRlZCBpZiB0aGUgY3VycmVudCBkYXkgbXVzdCBiZSBpbmNsdWRlZFxuICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDEpO1xuICB9IGVsc2Uge1xuICAgIC8vIGdldCBsYXN0IG1vbnRoXG4gICAgaWYgKGRhdGUuZ2V0TW9udGgoKSA9PT0gMCkge1xuICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSAtIDEsIDExLCBkYXRlLmdldERhdGUoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSAtIDEsIGRhdGUuZ2V0RGF0ZSgpKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgbW9udGhTdHJpbmcgPSBidWlsZDJEaWdpdHNEYXRlUGFydChkYXRlLmdldE1vbnRoKCkgKyAxKTtcbiAgY29uc3QgZGF0ZVN0cmluZyA9IGJ1aWxkMkRpZ2l0c0RhdGVQYXJ0KGRhdGUuZ2V0RGF0ZSgpKTtcbiAgcmV0dXJuIGAke2RhdGUuZ2V0RnVsbFllYXIoKX0tJHttb250aFN0cmluZ30tJHtkYXRlU3RyaW5nfWA7XG59XG5cbmRlc2NyaWJlKCdDb21wb25lbnQgVGVzdHMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdBdWRpdHNDb21wb25lbnQnLCAoKSA9PiB7XG4gICAgbGV0IGNvbXA6IEF1ZGl0c0NvbXBvbmVudDtcbiAgICBsZXQgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxBdWRpdHNDb21wb25lbnQ+O1xuICAgIGxldCBzZXJ2aWNlOiBBdWRpdHNTZXJ2aWNlO1xuICAgIGxldCBtb2NrUm91dGVyOiBNb2NrUm91dGVyO1xuICAgIGxldCBtb2NrQWN0aXZhdGVkUm91dGU6IE1vY2tBY3RpdmF0ZWRSb3V0ZTtcblxuICAgIGJlZm9yZUVhY2goYXN5bmMoKCkgPT4ge1xuICAgICAgVGVzdEJlZC5jb25maWd1cmVUZXN0aW5nTW9kdWxlKHtcbiAgICAgICAgaW1wb3J0czogW0tpcmFUZXN0TW9kdWxlXSxcbiAgICAgICAgZGVjbGFyYXRpb25zOiBbQXVkaXRzQ29tcG9uZW50XSxcbiAgICAgICAgcHJvdmlkZXJzOiBbQXVkaXRzU2VydmljZV0sXG4gICAgICB9KVxuICAgICAgICAub3ZlcnJpZGVUZW1wbGF0ZShBdWRpdHNDb21wb25lbnQsICcnKVxuICAgICAgICAuY29tcGlsZUNvbXBvbmVudHMoKTtcbiAgICB9KSk7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGZpeHR1cmUgPSBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudChBdWRpdHNDb21wb25lbnQpO1xuICAgICAgY29tcCA9IGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2U7XG4gICAgICBzZXJ2aWNlID0gZml4dHVyZS5kZWJ1Z0VsZW1lbnQuaW5qZWN0b3IuZ2V0KEF1ZGl0c1NlcnZpY2UpO1xuICAgICAgbW9ja1JvdXRlciA9IFRlc3RCZWQuZ2V0KFJvdXRlcik7XG4gICAgICBtb2NrQWN0aXZhdGVkUm91dGUgPSBUZXN0QmVkLmdldChBY3RpdmF0ZWRSb3V0ZSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndG9kYXkgZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHNldCB0b0RhdGUgdG8gY3VycmVudCBkYXRlJywgKCkgPT4ge1xuICAgICAgICBjb21wLm5nT25Jbml0KCk7XG4gICAgICAgIGV4cGVjdChjb21wLnRvRGF0ZSkudG9CZShnZXREYXRlKCkpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdpZiBjdXJyZW50IGRheSBpcyBsYXN0IGRheSBvZiBtb250aCB0aGVuIHNob3VsZCBzZXQgdG9EYXRlIHRvIGZpcnN0IGRheSBvZiBuZXh0IG1vbnRoJywgKCkgPT4ge1xuICAgICAgICBhZHZhbmNlVG8obmV3IERhdGUoMjAxOSwgMCwgMzEsIDAsIDAsIDApKTtcbiAgICAgICAgY29tcC5uZ09uSW5pdCgpO1xuICAgICAgICBleHBlY3QoY29tcC50b0RhdGUpLnRvQmUoJzIwMTktMDItMDEnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnaWYgY3VycmVudCBkYXkgaXMgbm90IGxhc3QgZGF5IG9mIG1vbnRoIHRoZW4gc2hvdWxkIHNldCB0b0RhdGUgdG8gbmV4dCBkYXkgb2YgY3VycmVudCBtb250aCcsICgpID0+IHtcbiAgICAgICAgYWR2YW5jZVRvKG5ldyBEYXRlKDIwMTksIDAsIDI3LCAwLCAwLCAwKSk7XG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcbiAgICAgICAgZXhwZWN0KGNvbXAudG9EYXRlKS50b0JlKCcyMDE5LTAxLTI4Jyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdwcmV2aW91c01vbnRoIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBzZXQgZnJvbURhdGUgdG8gcHJldmlvdXMgbW9udGgnLCAoKSA9PiB7XG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcbiAgICAgICAgZXhwZWN0KGNvbXAuZnJvbURhdGUpLnRvQmUoZ2V0RGF0ZShmYWxzZSkpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdpZiBjdXJyZW50IG1vbnRoIGlzIEphbnVhcnkgdGhlbiBzaG91bGQgc2V0IGZyb21EYXRlIHRvIHByZXZpb3VzIHllYXIgbGFzdCBtb250aCcsICgpID0+IHtcbiAgICAgICAgYWR2YW5jZVRvKG5ldyBEYXRlKDIwMTksIDAsIDIwLCAwLCAwLCAwKSk7XG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcbiAgICAgICAgZXhwZWN0KGNvbXAuZnJvbURhdGUpLnRvQmUoJzIwMTgtMTItMjAnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnaWYgY3VycmVudCBtb250aCBpcyBub3QgSmFudWFyeSB0aGVuIHNob3VsZCBzZXQgZnJvbURhdGUgdG8gY3VycmVudCB5ZWFyIHByZXZpb3VzIG1vbnRoJywgKCkgPT4ge1xuICAgICAgICBhZHZhbmNlVG8obmV3IERhdGUoMjAxOSwgMSwgMjAsIDAsIDAsIDApKTtcbiAgICAgICAgY29tcC5uZ09uSW5pdCgpO1xuICAgICAgICBleHBlY3QoY29tcC5mcm9tRGF0ZSkudG9CZSgnMjAxOS0wMS0yMCcpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQnkgZGVmYXVsdCwgb24gaW5pdCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc2V0IGFsbCBkZWZhdWx0IHZhbHVlcyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICBleHBlY3QoY29tcC50b0RhdGUpLnRvQmUoZ2V0RGF0ZSgpKTtcbiAgICAgICAgZXhwZWN0KGNvbXAuZnJvbURhdGUpLnRvQmUoZ2V0RGF0ZShmYWxzZSkpO1xuICAgICAgICBleHBlY3QoY29tcC5pdGVtc1BlclBhZ2UpLnRvQmUoSVRFTVNfUEVSX1BBR0UpO1xuICAgICAgICBleHBlY3QoY29tcC5wYWdlKS50b0JlKDEpO1xuICAgICAgICBleHBlY3QoY29tcC5hc2NlbmRpbmcpLnRvQmUoZmFsc2UpO1xuICAgICAgICBleHBlY3QoY29tcC5wcmVkaWNhdGUpLnRvQmUoJ2lkJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdPbkluaXQnLCAoKSA9PiB7XG4gICAgICBpdCgnU2hvdWxkIGNhbGwgbG9hZCBhbGwgb24gaW5pdCcsICgpID0+IHtcbiAgICAgICAgLy8gR0lWRU5cbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLmFwcGVuZCgnWC1Ub3RhbC1Db3VudCcsICcxJyk7XG4gICAgICAgIGNvbnN0IGF1ZGl0ID0gbmV3IEF1ZGl0KHsgcmVtb3RlQWRkcmVzczogJzEyNy4wLjAuMScsIHNlc3Npb25JZDogJzEyMycgfSwgJ3VzZXInLCAnMjAxNDAxMDEnLCAnQVVUSEVOVElDQVRJT05fU1VDQ0VTUycpO1xuICAgICAgICBzcHlPbihzZXJ2aWNlLCAncXVlcnknKS5hbmQucmV0dXJuVmFsdWUoXG4gICAgICAgICAgb2YoXG4gICAgICAgICAgICBuZXcgSHR0cFJlc3BvbnNlKHtcbiAgICAgICAgICAgICAgYm9keTogW2F1ZGl0XSxcbiAgICAgICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29tcC5uZ09uSW5pdCgpO1xuXG4gICAgICAgIC8vIFRIRU5cbiAgICAgICAgZXhwZWN0KHNlcnZpY2UucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgICAgZXhwZWN0KGNvbXAuYXVkaXRzICYmIGNvbXAuYXVkaXRzWzBdKS50b0VxdWFsKGphc21pbmUub2JqZWN0Q29udGFpbmluZyhhdWRpdCkpO1xuICAgICAgICBleHBlY3QoY29tcC50b3RhbEl0ZW1zKS50b0JlKDEpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQ3JlYXRlIHNvcnQgb2JqZWN0JywgKCkgPT4ge1xuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIHNweU9uKHNlcnZpY2UsICdxdWVyeScpLmFuZC5yZXR1cm5WYWx1ZShvZihuZXcgSHR0cFJlc3BvbnNlKHsgYm9keTogbnVsbCB9KSkpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdTaG91bGQgc29ydCBvbmx5IGJ5IGlkIGFzYycsICgpID0+IHtcbiAgICAgICAgLy8gR0lWRU5cbiAgICAgICAgbW9ja0FjdGl2YXRlZFJvdXRlLnNldFBhcmFtZXRlcnMoe1xuICAgICAgICAgIHNvcnQ6ICdpZCxkZXNjJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV0hFTlxuICAgICAgICBjb21wLm5nT25Jbml0KCk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBleHBlY3Qoc2VydmljZS5xdWVyeSkudG9CZUNhbGxlZFdpdGgoXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgc29ydDogWydpZCxkZXNjJ10sXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnU2hvdWxkIHNvcnQgYnkgdGltZXN0YW1wIGFzYyB0aGVuIGJ5IGlkJywgKCkgPT4ge1xuICAgICAgICAvLyBHSVZFTlxuICAgICAgICBtb2NrQWN0aXZhdGVkUm91dGUuc2V0UGFyYW1ldGVycyh7XG4gICAgICAgICAgc29ydDogJ3RpbWVzdGFtcCxhc2MnLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBXSEVOXG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcblxuICAgICAgICAvLyBUSEVOXG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLnF1ZXJ5KS50b0JlQ2FsbGVkV2l0aChcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBzb3J0OiBbJ3RpbWVzdGFtcCxhc2MnLCAnaWQnXSxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndHJhbnNpdGlvbicsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgbm90IHF1ZXJ5IGRhdGEgaWYgZnJvbURhdGUgYW5kIHRvRGF0ZSBhcmUgZW1wdHknLCAoKSA9PiB7XG4gICAgICAgIC8vIEdJVkVOXG4gICAgICAgIGNvbXAudG9EYXRlID0gJyc7XG4gICAgICAgIGNvbXAuZnJvbURhdGUgPSAnJztcblxuICAgICAgICAvLyBXSEVOXG4gICAgICAgIGNvbXAudHJhbnNpdGlvbigpO1xuXG4gICAgICAgIC8vIFRIRU5cbiAgICAgICAgZXhwZWN0KGNvbXAuY2FuTG9hZCgpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgZXhwZWN0KG1vY2tSb3V0ZXIubmF2aWdhdGVTcHkpLm5vdC50b0JlQ2FsbGVkKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBxdWVyeSBkYXRhIGlmIGZyb21EYXRlIGFuZCB0b0RhdGUgYXJlIG5vdCBlbXB0eScsICgpID0+IHtcbiAgICAgICAgLy8gR0lWRU5cbiAgICAgICAgY29tcC50b0RhdGUgPSBnZXREYXRlKCk7XG4gICAgICAgIGNvbXAuZnJvbURhdGUgPSBnZXREYXRlKGZhbHNlKTtcblxuICAgICAgICAvLyBXSEVOXG4gICAgICAgIGNvbXAudHJhbnNpdGlvbigpO1xuXG4gICAgICAgIC8vIFRIRU5cbiAgICAgICAgZXhwZWN0KGNvbXAuY2FuTG9hZCgpKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QobW9ja1JvdXRlci5uYXZpZ2F0ZVNweSkudG9CZUNhbGxlZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=